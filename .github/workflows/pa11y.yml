---
name: pa11y tests

# yamllint disable-line rule:truthy
on:
  pull_request:
  workflow_dispatch:

concurrency:
  group: ${{ github.ref }}-${{ github.workflow }}
  cancel-in-progress: true

jobs:
  build:
    name: Building site and running pa11y-ci tests
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source.
        uses: actions/checkout@v3

      - name: Use Node.js
        uses: actions/setup-node@v2
        with:
          node-version: 16

      - name: Setup browser
        uses: browser-actions/setup-chrome@latest

      - name: Install dependencies
        run: npm ci

      - name: Build site
        run: npx gulp && npx nuxt generate

      - name: Run pa11y
        uses: booleans-oss/pa11y-actions@v1
        with:
          start: "run dev"
          port: "3000"
