ARG IMAGE_NAME=node
ARG IMAGE_TAG=14
ARG APPHOME=/usr/src/app
ARG HOST=0.0.0.0
ARG PORT=3000
ARG NODE_ENVIRONMENT=production

FROM ${IMAGE_NAME}:${IMAGE_TAG}

ARG IMAGE_NAME
ARG IMAGE_TAG
ARG APPHOME
ARG HOST
ARG PORT
ARG NODE_ENVIRONMENT

RUN mkdir -p ${APPHOME}

WORKDIR ${APPHOME}

COPY . ${APPHOME}

RUN npm set unsafe-perm true \
  && npm install

ENV NODE_ENV=${NODE_ENVIRONMENT}

COPY . ${APPHOME}

RUN npm run build

ENV HOST=${HOST}
EXPOSE ${PORT}
ENV NUXT_HOST=${HOST}
ENV NUXT_PORT=${PORT}

CMD ["npm", "run", "dev"]
